# Задача о максимальном потоке.
## Вариант 8:
#### Пропускная способность дуг сети p(e) и стоимость транспортировки  единицы потока c(e):

| Дуги                      | sa | sb | sc | ac | ad | ab | bd | ct | dt |
|:--------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность    | 10 | 10 | 5  | 7  | 8  | 5  | 8  | 10 | 10 |
| Стоимость транспортировки | 1  | 1  | 1  | 2  | 3  | 1  | 1  | 2  | 1  |

## Решение:
### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|10|a
    s-->|10|b
    s-->|5|c
    a-->|5|b
    a-->|7|c
    a-->|8|d
    b-->|8|d
    c-->|10|t
    d-->|10|t
```

Укажем начальный поток величиной 5 **s -> c -> t**.
Построим остаточную сеть, дуги с нулевым весом удалим из сети.

```mermaid
graph RL
    t-.->|5|c
    t-.->|10|d
    b-.->|5|a
    c-.->|7|a
    d-.->|8|a
    d-.->|8|b
    a-.->|10|s
    b-.->|10|s
    
    s-->|5|c-->|5|t
```

### 2. Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> c -> a -> s. Минимальный вес дуг на этом пути равен 5.
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    t-.->|10|d
    b-.->|5|a
    c-.->|2|a
    d-.->|8|a
    d-.->|8|b
    a-.->|5|s
    b-.->|10|s
    
    s-->|5|c
    s-->|5|a-->|5|c-->|10|t
```

### 3. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> d -> a -> s. Минимальный вес дуг на этом пути равен 5.
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    t-.->|5|d
    b-.->|5|a
    c-.->|2|a
    d-.->|3|a
    d-.->|8|b
    b-.->|10|s
    
    s-->|5|c
    s-->|10|a-->|5|c-->|10|t

    a-->|5|d-->|5|t
```

### 4. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> d -> b -> s. Минимальный вес дуг на этом пути равен 5.
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    b-.->|5|a
    c-.->|2|a
    d-.->|3|a
    d-.->|3|b
    b-.->|5|s
    
    s-->|5|c
    s-->|10|a-->|5|c-->|10|t

    a-->|5|d-->|10|t

    s-->|5|b-->|5|d
```
### 5. Завершим поиск увеличивающего пути в остаточной сети
В остаточной сети больше нет увеличивающих путей, найденный поток величиной 20 является максимальным для данной сети.

```mermaid
graph LR
    s-->|"10, 10"|a
    s-->|"5, 10"|b
    s-->|"5, 5"|c
    a-->|"0, 5"|b
    a-->|"5, 7"|c
    a-->|"5, 8"|d
    b-->|"5, 8"|d
    c-->|"10, 10"|t
    d-->|"10, 10"|t
```
В данном случае левое число - локальный поток, правое - пропускная способность на дуге.

### 6. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | ad | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 10 | 10 | 5  | 7  | 8  | 5  | 8  | 10 | 10 |        |
| Локальный поток f(e)                          | 10 | 5  | 5  | 5  | 5  | 0  | 5  | 10 | 10 |        |
| Стоимость транспортировки единицы потока c(e) | 1  | 1  | 1  | 2  | 3  | 1  | 1  | 2  | 1  |        |
| Суммарная стоимость f(e)*c(e)                 | 10 | 5  | 5  | 10 | 15 | 0  | 5  | 20 | 10 | **80** |

Стоимость полученного потока составляет 80.

### 7. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph RL
    b-.->|1|a
    c-.->|2|a
    d-.->|3|a
    d-.->|1|b
    b-.->|1|s
    
    s-->|-1|c
    s-->|-1|a-->|-2|c-->|-2|t

    a-->|-3|d-->|-1|t

    s-->|-1|b-->|-1|d
```

В остаточной сети найден ориентированный цикл отрицательной стоимости s -> a -> d -> b -> s (- 1 - 3 + 1 + 1 = -2).
Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.

```mermaid
graph RL
    b-.->|5|a
    c-.->|2|a
    d-.->|3|a
    d-.->|3|b
    b-.->|5|s
    
    s-->|5|c
    s-->|10|a-->|5|c-->|10|t

    a-->|5|d-->|10|t

    s-->|5|b-->|5|d
```
В данном случае минимальный вес (**3**) имеет неиспользованный резерв ребра **d -> b**.
Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.
as3, da6, db8, sb8

```mermaid
graph RL
    b-.->|5|a
    c-.->|2|a
    d-.->|6|a
    b-.->|2|s
    a-.->|3|s
    
    s-->|5|c
    s-->|7|a-->|5|c-->|10|t

    a-->|2|d-->|10|t

    s-->|8|b-->|8|d
```

### 8. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph RL
    b-.->|1|a
    c-.->|2|a
    d-.->|3|a
    b-.->|1|s
    a-.->|3|s

    s-->|-1|c
    s-->|-1|a-->|-2|c-->|-2|t

    a-->|-3|d-->|-1|t

    s-->|-1|b-->|-1|d
```

В остаточной сети больше нет ориентированных циклов отрицательной стоимости

### 9. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | ad | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 10 | 10 | 5  | 7  | 8  | 5  | 8  | 10 | 10 |        |
| Локальный поток f(e)                          | 7  | 8  | 5  | 5  | 2  | 0  | 8  | 10 | 10 |        |
| Стоимость транспортировки единицы потока c(e) | 1  | 1  | 1  | 2  | 3  | 1  | 1  | 2  | 1  |        |
| Суммарная стоимость f(e)*c(e)                 | 7  | 8  | 5  | 10 | 6  | 0  | 8  | 20 | 10 | **74** |

Стоимость полученного потока составляет 68.

### Ответ:
Максимальный поток в сети равен 20, минимальная стоимость потока 74, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|"7, 10"|a
    s-->|"8, 10"|b
    s-->|"5, 5"|c
    a-->|"0, 5"|b
    a-->|"5, 7"|c
    a-->|"2, 8"|d
    b-->|"8, 8"|d
    c-->|"10, 10"|t
    d-->|"10, 10"|t
```