# Задание №10. Задача о максимальном потоке минимальной стоимости.
## Вариант 2:

### Постановка задачи
1. Дана сеть (взвешенный ориентированный граф) с источником s и стоком t.
2. Для каждой дуги определена пропускная способность и стоимость транспортировки.
3. Необходимо найти для указанной сети максимальный поток минимальной стоимости. 
### Пропускная способность дуг сети p(e) и стоимость транспортировки  единицы потока c(e):

|          Дуги            | sb | sc | ba | ad | bd | ca | ct | at | dt |
|:------------------------:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность   | 7  | 7  | 1  | 3  | 5  | 3  | 6  | 5  | 7  |
| Стоимость транспортировки| 2  | 5  | 2  | 2  | 3  | 3  | 7  | 2  | 8  |

### Задание
Для каждого варианта представлены условия задачи, в соответствии с которыми необходимо: 
1. Построить сеть с указанием пропускной способности дуг.
2. Построить остаточную сеть.
3. Определить максимальный поток методом поиска увеличивающих путей в остаточной сети.
4. Минимизировать стоимость максимального потока посредством поиска циклов отрицательной стоимости.
5. Оформить решение задачи по шагам с подробными комментариями, таблицами и диаграммами.
6. В ответе указать максимальную величину потока, минимальную стоимость транспортировки и сеть с указанием соответствующих локальных потоков.


### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|7|b
    b-->|1|a
    a-->|3|d
    b-->|5|d
    s-->|7|c
    c-->|3|a
    c-->|6|t
    a-->|5|t
    d-->|7|t
```
Построим остаточную сеть.

```mermaid
graph RL
    b-.->|7|s
    a-.->|1|b
    d-.->|3|a
    d-.->|5|b
    c-.->|7|s
    a-.->|3|c
    t-.->|6|c
    t-.->|5|a
    t-.->|7|d
   
```

### 2. Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> d -> b -> s. Минимальный вес дуг на этом пути равен 5.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    b-.->|2|s
    s-->|5|b
    a-.->|1|b
    d-.->|3|a
    b-->|5|d
    c-.->|7|s
    a-.->|3|c
    t-.->|6|c
    t-.->|5|a
    t-.->|2|d
    d-->|5|t
   
```
### 2.1. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> a -> c -> s. Минимальный вес дуг на этом пути равен 3.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    b-.->|2|s
    s-->|5|b
    a-.->|1|b
    d-.->|3|a
    b-->|5|d
    c-.->|4|s
    s-->|3|c
    c-->|3|a
    t-.->|6|c
    t-.->|2|a
    a-->|3|t
    t-.->|2|d
    d-->|5|t
   
```

### 2.2. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> c -> s. Минимальный вес дуг на этом пути равен 4.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    b-.->|2|s
    s-->|5|b
    a-.->|1|b
    d-.->|3|a
    b-->|5|d
    s-->|7|c
    c-->|3|a
    t-.->|2|c
    c-->|4|t
    t-.->|2|a
    a-->|3|t
    t-.->|2|d
    d-->|5|t
``` 
### 2.3. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> a -> b -> s. Минимальный вес дуг на этом пути равен 1.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    b-.->|1|s
    s-->|6|b
    b-->|1|a
    d-.->|3|a
    b-->|5|d
    c-.->|4|s
    s-->|7|c
    c-->|3|a
    t-.->|2|c
    c-->|4|t
    t-.->|1|a
    a-->|4|t
    t-.->|2|d
    d-->|5|t
```

### 3. Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной **13** является максимальным для данной сети.

```mermaid
graph LR
    s-->|6,7|b
    b-->|1,1|a
    a-->|0,3|d
    b-->|5,5|d
    s-->|7,7|c
    c-->|3,3|a
    c-->|4,6|t
    a-->|4,5|t
    d-->|5,7|t
```




### 4. Рассчитаем стоимость полученного максимального потока.

|          Дуги                                 | sb  | sc  | ba | ad | bd  | ca | ct | at | dt |Итого  |
|:---------------------------------------------:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:----:|
| Пропускная способность p(e)                   | 7   | 7   | 1  | 3  | 5   | 3  | 6   | 5  | 7  |  |
| Локальный поток f(e)                          | 6   | 7   | 1  | 0  | 5   | 3  | 4   | 4  | 5  |  |
| Стоимость транспортировки единицы потока c(e) | 2   | 5   | 2  | 2  | 3   | 3  | 7   | 2  | 8  |  |
| Суммарная стоимость f(e)*c(e)                 | 12  | 35  | 2  | 0  | 15  | 9  | 28  | 8  | 40 | **149** |


Стоимость полученного потока составляет **149**. 

### 5. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s-->|-2|b
    b-.->|2|s
    b-->|-2|a
    d-.->|2|a
    b-->|-3|d
    s-->|-5|c
    c-->|-3|a
    c-->|-7|t
    t-.->|7|c
    a-->|-2|t
    t-.->|2|a
    d-->|-8|t
    t-.->|8|d
```

В остаточной сети **не найден** ориентированный цикл отрицательной стоимости, следовательно, стоимость потока минимальна.

### 6. Для того, чтобы поработать с циклами отрицательной стоимости изменим конфигурацию потока.
Запустим поток величиной 13 следующим образом:
```mermaid
graph LR
    s-->|6,7|b
    b-->|1,1|a
    a-->|2,3|d
    b-->|5,5|d
    s-->|7,7|c
    c-->|3,3|a
    c-->|4,6|t
    a-->|2,5|t
    d-->|7,7|t
```
Рассчитаем стоимость:

|          Дуги                                 | sb  | sc  | ba | ad | bd  | ca | ct | at | dt |Итого  |
|:---------------------------------------------:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:----:|
| Пропускная способность p(e)                   | 7   | 7   | 1  | 3  | 5   | 3  | 6   | 5  | 7  |  |
| Локальный поток f(e)                          | 6   | 7   | 1  | 2  | 5   | 3  | 4   | 2  | 7  |  |
| Стоимость транспортировки единицы потока c(e) | 2   | 5   | 2  | 2  | 3   | 3  | 7   | 2  | 8  |  |
| Суммарная стоимость f(e)*c(e)                 | 12  | 35  | 2  | 4  | 15  | 9  | 28  | 4  | 56 | **165** |

### 7. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s-->|-2|b
    b-.->|2|s
    b-->|-2|a
    d-.->|2|a
    a-->|-2|d
    b-->|-3|d
    s-->|-5|c
    c-->|-3|a
    c-->|-7|t
    t-.->|7|c
    a-->|-2|t
    t-.->|2|a
    d-->|-8|t
    t-.->|8|d
```

В остаточной сети найден ориентированный цикл отрицательной стоимости t -> a -> d -> t (2 - 2 -8 = -8). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.  

```mermaid
graph RL
    b-.->|1|s
    s-->|6|b
    b-->|1|a
    d-.->|1|a
    a-->|2|d
    b-->|5|d
    c-.->|4|s
    s-->|7|c
    c-->|3|a
    t-.->|2|c
    c-->|4|t
    t-.->|3|a
    a-->|2|t
    d-->|7|t
```

Минимальный вес ребра в цикле 2 - это неиспользованный резерв ребра a -> d.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph RL
    b-.->|1|s
    s-->|6|b
    b-->|1|a
    d-.->|3|a
    b-->|5|d
    c-.->|4|s
    s-->|7|c
    c-->|3|a
    t-.->|2|c
    c-->|4|t
    t-.->|1|a
    a-->|4|t
    t-.->|2|d
    d-->|5|t
```

### 8. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s-->|-2|b
    b-.->|2|s
    b-->|-2|a
    d-.->|2|a
    b-->|-3|d
    s-->|-5|c
    c-->|-3|a
    c-->|-7|t
    t-.->|7|c
    a-->|-2|t
    t-.->|2|a
    d-->|-8|t
    t-.->|8|d
```
В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.



### 9. Рассчитаем стоимость полученного максимального потока.

|          Дуги                                 | sb  | sc  | ba | ad | bd  | ca | ct | at | dt |Итого  |
|:---------------------------------------------:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:----:|
| Пропускная способность p(e)                   | 7   | 7   | 1  | 3  | 5   | 3  | 6   | 5  | 7  |  |
| Локальный поток f(e)                          | 6   | 7   | 1  | 0  | 5   | 3  | 4   | 4  | 5  |  |
| Стоимость транспортировки единицы потока c(e) | 2   | 5   | 2  | 2  | 3   | 3  | 7   | 2  | 8  |  |
| Суммарная стоимость f(e)*c(e)                 | 12  | 35  | 2  | 0  | 15  | 9  | 28  | 8  | 40 | **149** |



### Ответ:
Максимальный поток в сети равен **13**, минимальная стоимость потока **149**, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|6,7|b
    b-->|1,1|a
    a-->|0,3|d
    b-->|5,5|d
    s-->|7,7|c
    c-->|3,3|a
    c-->|4,6|t
    a-->|4,5|t
    d-->|5,7|t
```
