# Задание №10. Вариант №1
# Задача о максимальном потоке минимальной стоимости.

Пропускная способность дуг сети и стоимость транспортировки указана в таблице.

| Дуги                                          | sa | sb | sc | aс | at | ab | bd | ct | dt |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  |  7 | 9  | 9  |
| Стоимость транспортировки единицы потока c(e) | 4  | 2  | 2  | 3  | 8  | 2  | 2  | 3  | 2  |

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг для поиска максимального потока.

```mermaid
graph LR
    s-->|9|a
    s-->|9|b
    s-->|4|c
    a-->|4|b
    a-->|6|c
    a-->|7|t
    b-->|7|d
    c-->|9|t
    d-->|9|t
```
Укажем начальный поток величиной 7 **s -> b -> d -> t**. Построим соответствующую остаточную сеть.

```mermaid
graph RL
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    s-->|7|b
    b-.->|2|s
    a-.->|9|s
    c-.->|4|s
    c-.->|6|a
    b-.->|4|a
    t-.->|9|c
    t-.->|7|a
```

### 2. Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> c -> a -> s. Минимальный вес дуг на этом пути равен 6.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph RL
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    s-->|7|b
    b-.->|2|s
    a-.->|3|s
    s-->|6|a
    c-.->|4|s
    a-->|6|c
    b-.->|4|a
    t-.->|3|c
    c-->|6|t
    t-.->|7|a
```

### 3. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> a -> s. Минимальный вес дуг на этом пути равен = 3.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    s-->|7|b
    b-.->|2|s
    s-->|9|a
    c-.->|4|s
    a-->|6|c
    b-.->|4|a
    t-.->|3|c
    c-->|6|t
    a-->|3|t
    t-.->|4|a
```

### 4. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> c -> s. Минимальный вес дуг на этом пути равен = 3.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    s-->|7|b
    b-.->|2|s
    s-->|9|a
    c-.->|1|s
    s-->|3|c
    a-->|6|c
    b-.->|4|a
    c-->|9|t
    a-->|3|t
    t-.->|4|a
```

### 5. Продолжим поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь t -> a -> c -> s. Минимальный вес дуг на этом пути равен = 1.

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    s-->|7|b
    b-.->|2|s
    s-->|9|a
    s-->|4|c
    a-->|5|c
    c-.->|1|a
    b-.->|4|a
    c-->|9|t
    a-->|4|t
    t-.->|3|a
```

### 6. Продолжим поиск увеличивающего пути в остаточной сети

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 9 является максимальным для данной сети.

```mermaid
graph LR
    s-->|9,9|a
    s-->|7,9|b
    s-->|4,4|c
    a-->|5,6|c
    a-->|4,7|t
    a-->|0,4|b
    b-->|7,7|d
    c-->|9,9|t
    d-->|7,9|t
```

### 7. Рассчитаем стоимость полученного максимального потока. В sb пропускную способность уменьшим до 7, а в bd увеличим до 9.

| Дуги                                          | sa | sb | sc | ac | at | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 9  | 7  | 4  | 6  | 7  | 4  | 9  | 9  | 9  |        |
| Локальный поток f(e)                          | 9  | 7  | 4  | 5  | 4  | 0  | 7  | 9  | 7  |        |
| Стоимость транспортировки единицы потока c(e) | 4  | 2  | 2  | 3  | 8  | 2  | 2  | 3  | 2  |        |
| Суммарная стоимость f(e)*c(e)                 | 36 | 14 | 8  | 15 | 32 | 0  | 14 | 27 | 14 | **160** |

Стоимость полученного потока составляет 160. 

```mermaid
graph LR
    s-->|9,9|a
    s-->|7,7|b
    s-->|4,4|c
    a-->|5,6|c
    a-->|4,7|t
    a-->|0,4|b
    b-->|7,9|d
    c-->|9,9|t
    d-->|7,9|t
```

### 8. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    t-.->|+2|d
    d-->|-2|t
    b-->|-2|d
    d-.->|+2|b
    s-->|-2|b
    s-->|-4|a
    s-->|-2|c
    a-->|-3|c
    c-.->|+3|a
    b-.->|+2|a
    c-->|-3|t
    a-->|-8|t
    t-.->|+8|a
```

В остаточной сети найден ориентированный цикл отрицательной стоимости b -> a -> t -> d -> b (+2 -8 +2 +2 = -2). 

Найдем минимальный вес ребра в указанном цикле, изображенном **в остаточной сети с указанием величины потока**.

```mermaid
graph LR
    t-.->|2|d
    d-->|7|t
    b-->|7|d
    d-.->|2|b
    s-->|7|b
    s-->|9|a
    s-->|4|c
    a-->|5|c
    c-.->|1|a
    b-.->|4|a
    c-->|9|t
    a-->|4|t
    t-.->|3|a
```

Минимальный вес ребра в цикле = 2.

Удалим найденный цикл - уменьшим на 2 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    d-->|9|t
    b-->|9|d
    s-->|7|b
    s-->|9|a
    s-->|4|c
    a-->|5|c
    c-.->|1|a
    b-.->|2|a
    a-->|2|b
    c-->|9|t
    a-->|2|t
    t-.->|5|a
```

### 9. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    d-->|-2|t
    b-->|-2|d
    s-->|-2|b
    s-->|-4|a
    s-->|-2|c
    a-->|-3|c
    c-.->|+3|a
    b-.->|+2|a
    a-->|-2|b
    c-->|-3|t
    a-->|-8|t
    t-.->|+8|a
```

В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.

### 10. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | at | ab | bd | ct | dt | Итого  |
|:----------------------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:------:|
| Пропускная способность p(e)                   | 9  | 7  | 4  | 6  | 7  | 4  | 9  | 9  | 9  |        |
| Локальный поток f(e)                          | 9  | 7  | 4  | 5  | 2  | 2  | 9  | 9  | 9  |        |
| Стоимость транспортировки единицы потока c(e) | 4  | 2  | 2  | 3  | 8  | 2  | 2  | 3  | 2  |        |
| Суммарная стоимость f(e)*c(e)                 | 36 | 14 | 8  | 15 | 16 | 4  | 18 | 27 | 18 | **156** |

Стоимость полученного потока составляет 156. 

### Ответ:
Максимальный поток в сети равен 20, минимальная стоимость потока 156, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s-->|9,9|a
    s-->|7,7|b
    s-->|4,4|c
    a-->|5,6|c
    a-->|2,7|t
    a-->|2,4|b
    b-->|9,9|d
    c-->|9,9|t
    d-->|9,9|t
```