# Задание №10
# Задача о максимальном потоке минимальной стоимости. Вариант 4.
#### Пропускная способность дуг сети p(e) и стоимость транспортировки  единицы потока c(e):

| Дуги                      | sa | sb | sc | ba | bc | cd | ac | ad | dt |
|:--------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность    | 6  | 6  | 6  | 6  | 5  | 10 | 5  | 8  | 12 |
| Стоимость транспортировки | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |

## Построим сеть с источником s, стоком t и пропускными способностями дуг для поиска максимального потока
```mermaid
graph LR;
    s-->|6|a;
    s-->|6|b;
    s-->|6|c;
    b-->|6|a;
    b-->|5|c;
    a-->|5|c;
    a-->|8|d;
    c-->|10|d;
    d-->|12|t;  
```

Укажем начальный поток величиной 6 $$s->a->d->t$$. Построим остаточную сеть.

```mermaid
graph LR
    s-->|6|a
    a-->|6|d
    d-.>|2|a
    d-->|6|t
    t-.->|6|-d
    d-.->|10|c
    c-.->|5|a
    c-.->|5|b
    c-.->|6|s
    b-.->|6|s
    a-.->|6|b
```

## Проведем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь $$t->d->a->b->s$$. Минимальный вес = 2
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым, удалим из остаточной сети.

```mermaid
graph LR
    s-->|6|a
    a-->|8|d
    d-->|8|t  
    t-.->|4|d
    d-.->|10|c
    c-.->|5|a
    c-.->|5|b
    c-.->|6|s
    b-.->|4|s
    s-->|2|b
    a-.->|4|b
    b-->|2|a
```

## Продолжаем поиск увеличивающего пути в остаточной сети
В остаточной сети найден увеличивающий путь $$t->d->c->a->b->s$$. Минимальный вес = 4
Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым, удалим из остаточной сети.

```mermaid
graph LR
    s-->|6|a
    s-->|6|b
    b-->|6|a
    a-->|8|d
    d-->|12|t  
    c-->|4|d
    d-.->|6|c
    a-->|4|c
    c-.->|1|a
    c-.->|5|b
    c-.->|6|s
```
## Завершаем поиск увеличивающего пути в остаточной сети
В остаточной сети больше нет увеличивающих путей, найден поток ыеличиной 12 - он максимален для сети

```mermaid
graph LR
    s-->|"6; 6"|a
    s-->|"6; 6"|b
    s-->|"0; 6"|c
    b-->|"6; 6"|a
    b-->|"0; 5"|c
    a-->|"4; 5"|c
    a-->|"8; 8"|d
    c-->|"4; 10"|d
    d-->|"12; 12"|t   
```
Левое число - локальный поток, правое - пропускная способность дуги

## Рассчитаем стоимость полученного максимального потока.

| Дуги                           | sa | sb | sc | ba | bc | cd | ac | ad | dt | Итого |
|:-------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)    | 6  | 6  | 6  | 6  | 5  | 10 | 5  | 8  | 12 |    |
| Локальный поток f(e)           | 6  | 6  | 0  | 6  | 0  | 4  | 4  | 8  | 12 |    |
| Стоимость транспортировки c(e) | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |    |
| Суммарная стоимость f(e)*c(e)  | 6  | 6  | 0  | 6  | 0  | 4  | 12 | 32 | 12 | 78 |

## (1) Попробуем уменьшить стоимость потока для чего построим остаточную сеть
Для каждого ребра остаточной сети укажем стоимость транспортировки.

```mermaid
graph LR
    s-->|-1|a
    s-->|-1|b
    b-->|-1|a
    a-->|-1|d
    d-->|-1|t  
    c-->|-1|d
    d-.->|1|c
    a-->|-3|c
    c-.->|3|a
    c-.->|1|b
    c-.->|3|s
```
В остаточной сети найден ориентированный цикл отрицательной стоимости $$s->b->a->d->c->s$$ (-1-1-4+1+3=-1)
Найдём минимальный вес ребра в этом цикле в остаточной сети с указанием величины потока.

```mermaid
graph LR
    s-->|6|a
    s-->|6|b
    b-->|6|a
    a-->|8|d
    d-->|12|t  
    c-->|4|d
    d-.->|6|c
    a-->|4|c
    c-.->|1|a
    c-.->|5|b
    c-.->|6|s
```

Минимальный вес = 6 имеет неиспользованный резерв рёбер $$d->c$$ и $$c->s$$. Уменьшим на 6 вес всех ребёр в цикле

```mermaid
graph LR
    s-->|6|a
    b-.->|6|s
    a-.->|6|b
    s-->|6|c
    c-.->|5|b
    a-->|4|c
    c-.->|1|a
    a-->|2|d
    d-.->|6|a
    c-->|10|d
    d-->|12|t  
```
## (2) Попробуем уменьшить стоимость потока для чего построим остаточную сеть

```mermaid
graph LR
    s-->|-1|a
    b-.->|1|s
    a-.->|1|b
    s-->|-3|c
    c-.->|1|b
    a-->|-3|c
    c-.->|3|a
    a-->|-4|d
    d-.->|4|a
    c-->|-1|d
    d-->|-1|t  
```

В остаточной сети найден ориентированный цикл отрицательной стоимости $$s->c->b->s$$ (-3+1+1=-1)
Найдём минимальный вес ребра в этом цикле в остаточной сети с указанием величины потока.

```mermaid
graph LR
    s-->|6|a
    b-.->|6|s
    a-.->|6|b
    s-->|6|c
    c-.->|5|b
    a-->|4|c
    c-.->|1|a
    a-->|2|d
    d-.->|6|a
    c-->|10|d
    d-->|12|t  
```
Минимальный вес = 5. Уменьшаем

```mermaid
graph LR
    s-->|6|a
    s-->|1|c
    c-.->|5|s
    s-->|5|b
    b-.->|1|s
    a-.->|6|b
    b-->|5|c
    a-->|4|c
    c-.->|1|a
    a-->|2|d
    d-.->|6|a
    c-->|10|d
    d-->|12|t  
```

## (3) Попробуем уменьшить стоимость потока для чего построим остаточную сеть
    
```mermaid
graph LR
    s-->|-1|a
    s-->|-3|c
    c-.->|3|s
    s-->|-1|b
    b-.->|1|s
    a-.->|1|b
    b-->|-1|c
    a-->|-3|c
    c-.->|3|a
    a-->|-4|d
    d-.->|4|a
    c-->|-1|d
    d-->|-1|t  
```

В остаточной сети найден ориентированный цикл отрицательной стоимости $$s->a->c->s$$ (-1-3+3=-1)
Найдём минимальный вес ребра в этом цикле в остаточной сети с указанием величины потока.
```mermaid
graph LR
    s-->|6|a
    s-->|1|c
    c-.->|5|s
    s-->|5|b
    b-.->|1|s
    a-.->|6|b
    b-->|5|c
    a-->|4|c
    c-.->|1|a
    a-->|2|d
    d-.->|6|a
    c-->|10|d
    d-->|12|t  
```
Минимальный вес = 5. Уменьшаем

```mermaid
graph LR
    s-->|2|a
    a-.->|4|s
    s-->|5|b
    b-.->|1|s
    s-->|5|c
    c-.->|1|s
    a-.->|6|b
    b-->|5|c
    c-.->|5|a    
    a-->|2|d
    d-.->|6|a
    c-->|10|d
    d-->|12|t  
```

## (4) Попробуем уменьшить стоимость потока для чего построим остаточную сеть
```mermaid
graph LR
    s-->|-1|a
    a-.->|1|s
    s-->|-1|b
    b-.->|1|s
    s-->|-3|c
    c-.->|3|s
    a-.->|1|b
    b-->|-1|c
    c-.->|3|a    
    a-->|-4|d
    d-.->|4|a
    c-->|-1|d
    d-->|-1|t  
```
В остаточной сети больше нет ориентированных циклов отрицательной стоимости

```mermaid
graph LR
    s-->|"2; 6"|a
    s-->|"5; 6"|b
    s-->|"5; 6"|c
    b-->|"0; 6"|a
    b-->|"5; 5"|c
    a-->|"0; 5"|c
    a-->|"2; 8"|d
    c-->|"10; 10"|d
    d-->|"12; 12"|t   
```

| Дуги                           | sa | sb | sc | ba | bc | cd | ac | ad | dt | Итого |
|:-------------------------------|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)    | 6  | 6  | 6  | 6  | 5  | 10 | 5  | 8  | 12 |    |
| Локальный поток f(e)           | 2  | 5  | 5  | 0  | 5  | 10 | 0  | 2  | 12 |    |
| Стоимость транспортировки c(e) | 1  | 1  | 3  | 1  | 1  | 1  | 3  | 4  | 1  |    |
| Суммарная стоимость f(e)*c(e)  | 2  | 5  | 15 | 0  | 5  | 10 | 0  | 8  | 12 | 57 |

Стоимость полученного потока составляет 57.

# Ответ:
Максимальный поток в сети равен 12, минимальная стоимость потока 68
