# Задание №6

## Оптимальное расписание. Стратегия разделения процессоров

## Решение
### 1. Условия задачи
Составить расписание минимальной длительности с прерываниями для системы из пяти заданий A, B, C, D, E длительности 18, 12, 12, 12, 6 и трёх исполнителей с производительностью 6, 4, 2. Ответ дать в виде диаграммы Ганта.

| Задания      |  A  |  B  |  C  |  D  |  E  |
|:-------------|:---:|:---:|:---:|:---:|:---:|
| Длительность |  18 |  12 |  12 |  12 |  6  |


| Исполнители        |  1  |  2  |  3  |
|:-------------------|:---:|:---:|:---:|
| Производительность |  6  |  4  |  2  |

### 2. Шаг 1: Расчет минимального времени
Посчитаем длительность оптимального расписания для $3$ исполнителей и $5$ заданий по формуле:

$$  
T_{min} = \frac {V_1 + V_2 + ... + V_n}{p_1 + p_2 + ... + p_k}  =  \frac {18 + 12 + 12 + 12 + 6}{6 + 4 + 2} = 5
$$  

Таким образом, минимальное время выполнения всех задач — **5 единиц времени**.

### 3. Шаг 2: Определение приоритетов и распределение задач

Для описания алгоритма построения оптимального расписания введем понятие **приоритета задания** в определенный момент времени - объем оставшейся части задания, которая в данный момент еще не выполнена. В начальный момент времени приоритет задания соответствует его объему. 
#### Алгоритм:
1. Выбрать задания с самым высоким приоритетом (может быть одно задание или несколько заданий с одинаковым приоритетом), назначить на эти задания одного или несколько самых производительных работников. Если остались свободные работники назначить их на задания со следующим приоритетом.
2. Работники выполняют задания до тех пор, пока не наступит одно из событий:
- какое-либо задание будет завершено и освободится исполнитель,
- сравняются приоритеты у каких-то заданий, если до того эти приоритеты были разные, то есть с изменением приоритетов необходимо переназначить работников на задания согласно шагу 1.

| Задание      |  A  |  B  |  C  |  D  |  E  |
|:-------------|:---:|:---:|:---:|:---:|:---:|
| Длительность |  18 |  12 |  12 |  12 |  6  |
| Приоритет    |  II |  II |  II |  II | III |
| Исполнитель  |  1  |2 и 3|2 и 3|2 и 3|  -  |

**Основная идея алгоритма**: задания с высоким приоритетом выполняет работник с высокой производительностью.

Изначально задача A = 18 имеет самый большой объем. Назначим на нее самого производительного исполнителя (p1 с производительностью 6). Оставшихся исполнителей (p2 и p3 с производительностью 4 и 2) назначим на задачи с равными обьемами (B = 12, C = 12, D = 12).

### 4. Шаг 3: Перераспределение задач
Вычислим время когда какое-либо задание будет завершено и освободится исполнитель или сравняются приоритеты у каких-то заданий.
***BCD = A***:

$$
12 - 2t = 18 - 6t
$$

$$
t = 1.5
$$

***A = E***:

$$
18 - 6t = 6
$$

$$
t = 2
$$

Объемы задач A, B, C, D сравнятся спустя 1.5 единиц времени. 
##### После 1.5 единиц времени:

| Задание      |  A  |  B  |  C  |  D  |  E  |
|:-------------|:---:|:---:|:---:|:---:|:---:|
| Длительность |  9  |  9  |  9  |  9  |  6  |
| Приоритет    |  I  |  I  |  I  |  I  |  II |
| Исполнитель  |1, 2, 3|1, 2, 3|1, 2, 3|1, 2, 3|  -  |

Вычислим следующую точку перераспределения:
***ABCD = E***:

$$
9 - 3t = 6
$$

$$
t = 1
$$
Объемы задач A, B, C, D, E сравнятся спустя 1 единицу времени. 
##### После 2.5 единиц времени:

| Задание      |  A  |  B  |  C  |  D  |  E  |
|:-------------|:---:|:---:|:---:|:---:|:---:|
| Длительность |  6  |  6  |  6  |  6  |  6  |
| Приоритет    |  I  |  I  |  I  |  I  |  I  |
| Исполнитель  |1, 2, 3|1, 2, 3|1, 2, 3|1, 2, 3|1, 2, 3|

***ABCDE = 0***:

$$
6 - \frac{6 + 4 + 2}{5}*t = 0
$$

$$
t = 2.5
$$

Все задачи завершатся еще через 2.5 единиц времени. 

### 5. Диаграмма Ганта

Оптимальное расписание:

```mermaid
gantt
    title Диаграмма Ганта - Стратегия разделения процессоров
    dateFormat DD HH:mm
    axisFormat %H:%M
    Начало выполнения работ : milestone, m1, 01 00:00, 0h
    section Исполнитель 1
    A         :a1, 01 00:00, 1.5h
    A         :a2, after a1, 0.25h
    B         :a3, after a2, 0.25h
    C         :a4, after a3, 0.25h
    D         :a5, after a4, 0.25h
    A         :a6, after a5, 0.5h
    B         :a7, after a6, 0.5h
    C         :a8, after a7, 0.5h
    D         :a9, after a8, 0.5h
    E         :a10, after a9, 0.5h

    section Исполнитель 2
    B         :b1, 01 00:00, 0.5h
    C         :b2, after b1, 0.5h
    D         :b3, after b2, 0.5h
    B         :b4, after b3, 0.25h
    A         :b5, after b4, 0.25h
    D         :b6, after b5, 0.25h
    C         :b7, after b6, 0.25h
    B         :b8, after b7, 0.5h
    D         :b9, after b8, 0.5h
    E         :b10, after b9, 0.5h
    A         :b11, after b10, 0.5h
    C         :b12, after b11, 0.5h

    section Исполнитель 3
    D         :c1, 01 00:00, 0.5h
    B         :c2, after c1, 0.5h
    C         :c3, after c2, 0.5h
    D         :c4, after c3, 0.25h
    C         :c5, after c4, 0.25h
    B         :c6, after c5, 0.25h
    A         :c7, after c6, 0.25h
    E         :c8, after c7, 0.5h
    C         :c9, after c8, 0.5h
    D         :c10, after c9, 0.5h
    B         :c11, after c10, 0.5h
    A         :c12, after c11, 0.5h
    Окончание выполнения работ : milestone, m2, 01 05:00, 0h
```

